<!doctype html>
<html lang="en">
    {% include 'maps/head.html' %}
<body>
    {% include 'maps/navbar.html' %}
    <div class="container col-12">
        <div class="h1 text-center p-5">
            Lista de destinos
        </div>
        <div class="col-5 text-center">
            <form action="/destinations/filtered" method="GET">
                <select style="color:rgb(80,80,80)" name="filter" class="form-select form-select-lg mb-3" aria-label="Default select example">
                    <option value="distrito">Distrito</option>
                    <option value="nombre">Nombre</option>
                    <option value="categoria">Categoria</option>
                    <option value="tipo_categoria">Tipo</option>
                    <option value="subtipo_categoria">Subtipo</option>
                </select>
                <div class="input-group mb-3">
                    <div class="input-group-prepend">
                        <span style="color:white;" class="input-group-text bg-secondary" id="basic-addon1">Nombre</span>
                    </div>
                    <input style="color:rgb(80,80,80)" type="text" name="value" class="form-control">
                </div>
                <input type="submit" value="Buscar" class="btn btn-outline-primary m-2">
            </form>
        </div>
        <!---------------------------TABLE----------------------------->
        <table class="table table-sm">
            <thead>
              <tr>
                <th scope="col">Distrito</th>
                <th scope="col">Nombre</th>
                <th scope="col">Categoria</th>
                <th scope="col">Tipo</th>
                <th scope="col">Subtipo</th>
                <th scope="col">Puntaje</th>
                <th scope="col">Calificacion</th>
              </tr>
            </thead>
            <tbody>
            {% for dest in destinos %}
                <tr>
                    <td>{{dest.distrito}}</td>
                    <td>{{dest.nombre}}</td>
                    <td>{{dest.categoria}}</td>
                    <td>{{dest.tipo_categoria}}</td>
                    <td>{{dest.subtipo_categoria}}</td>
                    <td>{{dest.calificacion|truncatechars:6}}</td>
                    <td>
                        <form action="/destinations/see" method="GET">
                            <input type="submit" value="Ver">
                        </form>
                        <form action="/destinations/all" method="POST">
                            {% csrf_token %}
                            <span class="estrella{{dest.codigo}}" onclick="calificar(this, {{dest.codigo}},1, 'yellow')">★</span>
                            <span class="estrella{{dest.codigo}}" onclick="calificar(this, {{dest.codigo}},2, 'yellow')">★</span>
                            <span class="estrella{{dest.codigo}}" onclick="calificar(this, {{dest.codigo}},3, 'yellow')">★</span>
                            <span class="estrella{{dest.codigo}}" onclick="calificar(this, {{dest.codigo}},4, 'yellow')">★</span>
                            <span class="estrella{{dest.codigo}}" onclick="calificar(this, {{dest.codigo}},5, 'yellow')">★</span>
                            <input type="text" name="codigo" value="{{dest.codigo}}" hidden>
                            <input type="number" id="puntaje{{dest.codigo}}" name="calificacion" value="0" hidden>
                            <input type="submit" value="Calificar">
                        </form>
                    </td>
                </tr>
            {% endfor %}
            </tbody>
        </table>
    </div>
    <script>
        var destinos_data;
        function calificar(event, codigo , puntaje, color)
        {
            let puntajeNuevo = Number.parseInt(puntaje);
            let estrellas = document.getElementsByClassName("estrella"+codigo);
            for(let i=0 ; i<puntajeNuevo ; i++)
                estrellas[i].style.color=color;
            for(let i=4 ; i>=puntajeNuevo ; i--)
                estrellas[i].style.color="black";
            input_puntaje = document.getElementById("puntaje"+codigo);
            input_puntaje.setAttribute('value', puntaje);
        }
    </script>
</body>
</html>